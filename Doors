-- Load XaLib UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/XasonYTB/XaLib/refs/heads/main/UILibrary.lua"))()

-- Create Window
local Window = Library:CreateWindow({
    Title = "ZeScript's Doors",
    Size = Vector2.new(700, 500),
    Keybind = Enum.KeyCode.RightShift
})

-- Floor Detection System
local currentFloor = "Unknown"
local function detectFloor()
    pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local gameData = ReplicatedStorage:FindFirstChild("GameData")
        if gameData then
            local floorValue = gameData:FindFirstChild("Floor")
            if floorValue then
                currentFloor = floorValue.Value
            end
        end
    end)
    return currentFloor
end

-- Detect floor at start
currentFloor = detectFloor()

-- Create Exploit Category
local ExploitCategory = Window:CreateCategory("Exploits", "âš¡")

-- Variables
local spoofCrouchEnabled = false
local spoofCrouchLoop

-- Store UI elements reference (no longer needed for visibility)
local uiElements = {
    Hotel = {},
    Mines = {},
    Universal = {}
}

-- Spoof Crouch Toggle (Universal)
ExploitCategory:Toggle("Spoof Crouch", false, function(enabled)
    spoofCrouchEnabled = enabled
    
    if enabled then
        spoofCrouchLoop = task.spawn(function()
            while spoofCrouchEnabled do
                pcall(function()
                    game.ReplicatedStorage.RemotesFolder.Crouch:FireServer(true, true)
                end)
                task.wait(0.32)
            end
        end)
    else
        if spoofCrouchLoop then
            task.cancel(spoofCrouchLoop)
            spoofCrouchLoop = nil
        end
    end
end)

local screechDisabled = false
local screechOriginalParent = nil

ExploitCategory:Toggle("Disable Screech", false, function(enabled)
    screechDisabled = enabled
    
    pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local screech = ReplicatedStorage.Entities:FindFirstChild("Screech")
        
        if enabled and screech then
            local zeScriptStuff = ReplicatedStorage:FindFirstChild("ZeScript_Stuff")
            if not zeScriptStuff then
                zeScriptStuff = Instance.new("Folder")
                zeScriptStuff.Name = "ZeScript_Stuff"
                zeScriptStuff.Parent = ReplicatedStorage
            end
            
            local disabledEntity = zeScriptStuff:FindFirstChild("DisabledEntity")
            if not disabledEntity then
                disabledEntity = Instance.new("Folder")
                disabledEntity.Name = "DisabledEntity"
                disabledEntity.Parent = zeScriptStuff
            end
            
            screechOriginalParent = screech.Parent
            screech.Parent = disabledEntity
        elseif not enabled and screech and screechOriginalParent then
            screech.Parent = screechOriginalParent
        end
    end)
end)

-- AntiSpeed Bypass Toggle (Hotel only, NOT for Mines)
local antiSpeedEnabled = false
local antiSpeedLoop
local clonedCollision

if not (currentFloor == "Mines") then
    ExploitCategory:Toggle("AntiSpeed Bypass", false, function(enabled)
    antiSpeedEnabled = enabled
    
    if enabled then
        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
            local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local CollisionPart = Character:WaitForChild("CollisionPart")
            
            clonedCollision = CollisionPart:Clone()
            clonedCollision.Name = "_CollisionClone"
            clonedCollision.Massless = true
            clonedCollision.Parent = Character
            clonedCollision.CanCollide = false
            clonedCollision.CanQuery = false
            clonedCollision.CustomPhysicalProperties = PhysicalProperties.new(0.01, 0.7, 0, 1, 1)
            
            antiSpeedLoop = task.spawn(function()
                while antiSpeedEnabled do
                    task.wait(0.23)
                    if clonedCollision then
                        clonedCollision.Massless = false
                        task.wait(0.23)
                        local root = Character:FindFirstChild("HumanoidRootPart")
                        if root and root.Anchored then
                            clonedCollision.Massless = true
                            task.wait(1)
                        end
                        clonedCollision.Massless = true
                    end
                end
            end)
        end)
    else
        antiSpeedEnabled = false
        if antiSpeedLoop then
            task.cancel(antiSpeedLoop)
            antiSpeedLoop = nil
        end
        if clonedCollision then
            clonedCollision:Destroy()
            clonedCollision = nil
        end
    end
end)
end

-- Mines Anticheat Bypass (Mines only)
local bypassEnabled = false
local bypassLoop
local ladderESP = {}

if currentFloor == "Mines" or currentFloor == "Unknown" then
    ExploitCategory:Toggle("Anticheat Bypass (Mines)", false, function(enabled)
    bypassEnabled = enabled
    
    if enabled then
        -- ESP all ladders
        for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
            pcall(function()
                local ladder = room:FindFirstChild("Ladder", true)
                if ladder then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(0, 100, 255)
                    highlight.OutlineColor = Color3.fromRGB(0, 150, 255)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                    highlight.Parent = ladder
                    table.insert(ladderESP, highlight)
                end
            end)
        end
        
        bypassLoop = task.spawn(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            
            while bypassEnabled do
                task.wait(0.1)
                pcall(function()
                    local Character = LocalPlayer.Character
                    if Character then
                        local climbingAttr = Character:GetAttribute("Climbing")
                        if climbingAttr == true then
                            Window:Notify({
                                Text = "[Bypass]: Please wait 2 seconds and don't move",
                                Duration = 2,
                                Type = "Warning"
                            })
                            task.wait(0.5)
                            Character:SetAttribute("Climbing", false)
                        end
                    end
                end)
            end
        end)
    else
        if bypassLoop then
            task.cancel(bypassLoop)
            bypassLoop = nil
        end
        
        for _, highlight in pairs(ladderESP) do
            if highlight and highlight.Parent then
                highlight:Destroy()
            end
        end
        ladderESP = {}
    end
end)
end

-- Speed System Variables
local speedEnabled = false
local originalWalkSpeed = 16
local speedValue = 16
local speedLoop

-- Speed Toggle (Universal, works unless Mines floor)
ExploitCategory:Toggle("Speed", false, function(enabled)
    if enabled and not antiSpeedEnabled and not bypassEnabled then
        Window:Notify({
            Text = "Please enable a bypass first! (AntiSpeed for Hotel, Anticheat for Mines)",
            Duration = 4,
            Type = "Warning"
        })
        speedEnabled = false
        return
    end
    
    -- Only allow Speed on non-Mines floors
    if currentFloor == "Mines" then
        Window:Notify({
            Text = "Speed is disabled on Mines floor!",
            Duration = 3,
            Type = "Warning"
        })
        speedEnabled = false
        return
    end
    
    speedEnabled = enabled
    
    if enabled then
        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local Character = LocalPlayer.Character
            
            if Character then
                local Humanoid = Character:FindFirstChild("Humanoid")
                if Humanoid then
                    originalWalkSpeed = Humanoid.WalkSpeed
                end
            end
        end)
        
        speedLoop = task.spawn(function()
            while speedEnabled do
                task.wait(0.1)
                pcall(function()
                    local Players = game:GetService("Players")
                    local LocalPlayer = Players.LocalPlayer
                    local Character = LocalPlayer.Character
                    
                    if Character then
                        local Humanoid = Character:FindFirstChild("Humanoid")
                        if Humanoid then
                            Humanoid.WalkSpeed = speedValue
                        end
                    end
                end)
            end
        end)
    else
        if speedLoop then
            task.cancel(speedLoop)
            speedLoop = nil
        end
        
        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local Character = LocalPlayer.Character
            
            if Character then
                local Humanoid = Character:FindFirstChild("Humanoid")
                if Humanoid then
                    Humanoid.WalkSpeed = originalWalkSpeed
                end
            end
        end)
    end
end)
table.insert(uiElements.Universal, speedToggle)

-- No Acceleration Toggle (Universal)
local noAccelEnabled = false
local noAccelLoop = nil
local originalHrpProps = nil

ExploitCategory:Toggle("No Acceleration", false, function(enabled)
    noAccelEnabled = enabled

    if enabled then
        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
            local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local hrp = Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                originalHrpProps = hrp.CustomPhysicalProperties
                hrp.CustomPhysicalProperties = PhysicalProperties.new(100, 0.7, 0, 1, 1)
            end
        end)

        noAccelLoop = task.spawn(function()
            while noAccelEnabled do
                task.wait(0.5)
                pcall(function()
                    local Players = game:GetService("Players")
                    local LocalPlayer = Players.LocalPlayer
                    local Character = LocalPlayer and LocalPlayer.Character
                    if Character then
                        local hrp = Character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            local cpp = hrp.CustomPhysicalProperties
                            if not cpp or cpp.Density ~= 100 then
                                hrp.CustomPhysicalProperties = PhysicalProperties.new(100, 0.7, 0, 1, 1)
                            end
                        end
                    end
                end)
            end
        end)
    else
        if noAccelLoop then
            task.cancel(noAccelLoop)
            noAccelLoop = nil
        end

        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local Character = LocalPlayer and LocalPlayer.Character
            if Character then
                local hrp = Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    hrp.CustomPhysicalProperties = originalHrpProps
                end
            end
        end)

        originalHrpProps = nil
    end
end)
table.insert(uiElements.Universal, noAccelToggle)

-- Speed Slider (Universal)
ExploitCategory:Slider("Speed Value", 2, 250, 16, function(value)
    speedValue = value
end)

-- Proximity Prompt Reach Variables
local proximityReach = 0

-- Proximity Prompt Reach Slider (Universal)
ExploitCategory:Slider("Proximity Prompt Reach", 0, 12, 0, function(value)
    proximityReach = value
end)

-- Auto Proxi Variables
local autoProxiEnabled = false
local autoProxiLoop

-- Auto Proxi Toggle (Universal)
local UserInputService = game:GetService("UserInputService")
local isRKeyHeld = false

-- Track R key state
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.R and not gameProcessed then
        isRKeyHeld = true
    end
end)

UserInputService.InputEnded:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.R then
        isRKeyHeld = false
    end
end)

ExploitCategory:Toggle("Auto Proxi", false, function(enabled)
    autoProxiEnabled = enabled
    
    if enabled then
        autoProxiLoop = task.spawn(function()
            while autoProxiEnabled do
                task.wait(0.34)
                pcall(function()
                    -- Only run if R key is held
                    if not isRKeyHeld then
                        return
                    end
                    
                    local Players = game:GetService("Players")
                    local LocalPlayer = Players.LocalPlayer
                    local Character = LocalPlayer and LocalPlayer.Character
                    
                    if Character then
                        local hrp = Character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            -- Check all proximity prompts in the workspace
                            for _, prompt in pairs(game:FindFirstChild("Workspace"):FindFirstChild("CurrentRooms"):GetDescendants() or {}) do
                                if prompt:IsA("ProximityPrompt") then
                                    local promptParent = prompt.Parent
                                    local distance = (hrp.Position - promptParent.Position).Magnitude
                                    
                                    -- Check if player is in range (use proximity reach if > 0)
                                    local range = promptParent:IsA("BasePart") and promptParent.Size.X or 0
                                    if proximityReach > 0 then
                                        range = proximityReach
                                    else
                                        range = prompt.MaxActivationDistance or 20
                                    end
                                    
                                    if distance <= range then
                                        local actionText = prompt.ActionText or ""
                                        
                                        -- Check for UnlockPrompt
                                        if prompt.Name == "UnlockPrompt" then
                                            prompt.HoldDuration = 0
                                            prompt:InputHoldBegin()
                                            prompt:InputHoldEnd()
                                        -- Check ActionText for Open or Obtain
                                        elseif actionText == "Open" or actionText == "Obtain" then
                                            prompt:InputHoldBegin()
                                            prompt:InputHoldEnd()
                                        -- Don't interact if ActionText is Close
                                        elseif actionText ~= "Close" then
                                            -- Interact with other prompts
                                            prompt:InputHoldBegin()
                                            prompt:InputHoldEnd()
                                        end
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        end)
    else
        if autoProxiLoop then
            task.cancel(autoProxiLoop)
            autoProxiLoop = nil
        end
    end
end)
table.insert(uiElements.Universal, autoProxiToggle)

-- Fly and Noclip (Universal)
local flyEnabled = false
local noclipEnabled = false
local flyLoop

ExploitCategory:Toggle("Fly", false, function(enabled)
    flyEnabled = enabled
    
    if enabled then
        flyLoop = task.spawn(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local UserInputService = game:GetService("UserInputService")
            
            while flyEnabled do
                task.wait()
                pcall(function()
                    local Character = LocalPlayer.Character
                    if Character then
                        local climbingAttr = Character:GetAttribute("Climbing")
                        if climbingAttr == false or climbingAttr == nil then
                            local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
                            if HumanoidRootPart then
                                local velocity = Vector3.new(0, 0, 0)
                                
                                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                                    velocity = velocity + (workspace.CurrentCamera.CFrame.LookVector * 2)
                                end
                                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                                    velocity = velocity - (workspace.CurrentCamera.CFrame.LookVector * 2)
                                end
                                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                                    velocity = velocity - (workspace.CurrentCamera.CFrame.RightVector * 2)
                                end
                                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                                    velocity = velocity + (workspace.CurrentCamera.CFrame.RightVector * 2)
                                end
                                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                                    velocity = velocity + Vector3.new(0, 2, 0)
                                end
                                if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                                    velocity = velocity - Vector3.new(0, 2, 0)
                                end
                                
                                HumanoidRootPart.Velocity = velocity
                                HumanoidRootPart.Anchored = false
                            end
                        end
                    end
                end)
            end
        end)
    else
        if flyLoop then
            task.cancel(flyLoop)
            flyLoop = nil
        end
    end
end)
table.insert(uiElements.Universal, flyToggle)

ExploitCategory:Toggle("Noclip", false, function(enabled)
    noclipEnabled = enabled
    
    task.spawn(function()
        while noclipEnabled do
            task.wait()
            pcall(function()
                local Players = game:GetService("Players")
                local LocalPlayer = Players.LocalPlayer
                local Character = LocalPlayer.Character
                
                if Character then
                    local climbingAttr = Character:GetAttribute("Climbing")
                    if climbingAttr == false or climbingAttr == nil then
                        for _, part in pairs(Character:GetDescendants()) do
                            if part:IsA("BasePart") then
                                part.CanCollide = false
                            end
                        end
                    end
                end
            end)
        end
        
        pcall(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local Character = LocalPlayer.Character
            
            if Character then
                for _, part in pairs(Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.CanCollide = true
                    end
                end
            end
        end)
    end)
end)

-- Create Visual Category
local VisualCategory = Window:CreateCategory("Visual", "ðŸ‘ï¸")

-- Variables for Fullbright (Universal)
local fullbrightEnabled = false
local originalLighting = {}
local lightingConnection

VisualCategory:Toggle("Fullbright", false, function(enabled)
    fullbrightEnabled = enabled
    
    if enabled then
        local Lighting = game:GetService("Lighting")
        originalLighting = {
            Brightness = Lighting.Brightness,
            ClockTime = Lighting.ClockTime,
            FogEnd = Lighting.FogEnd,
            GlobalShadows = Lighting.GlobalShadows,
            Ambient = Lighting.Ambient
        }
        
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
        Lighting.Ambient = Color3.fromRGB(178, 178, 178)
        
        lightingConnection = Lighting.Changed:Connect(function(property)
            if fullbrightEnabled then
                if property == "Brightness" and Lighting.Brightness ~= 2 then
                    Lighting.Brightness = 2
                elseif property == "ClockTime" and Lighting.ClockTime ~= 14 then
                    Lighting.ClockTime = 14
                elseif property == "FogEnd" and Lighting.FogEnd ~= 100000 then
                    Lighting.FogEnd = 100000
                elseif property == "GlobalShadows" and Lighting.GlobalShadows ~= false then
                    Lighting.GlobalShadows = false
                elseif property == "Ambient" and Lighting.Ambient ~= Color3.fromRGB(178, 178, 178) then
                    Lighting.Ambient = Color3.fromRGB(178, 178, 178)
                end
            end
        end)
    else
        if lightingConnection then
            lightingConnection:Disconnect()
            lightingConnection = nil
        end
        
        local Lighting = game:GetService("Lighting")
        for property, value in pairs(originalLighting) do
            Lighting[property] = value
        end
    end
end)
table.insert(uiElements.Universal, fullbrightToggle)

-- FOV Slider (Universal)
local RunService = game:GetService("RunService")
local desiredFOV = 70
local fovConnection

-- Strong FOV enforcement: use RenderStepped to set the camera FOV every frame.
-- RenderStepped runs before the frame is rendered, making it harder for the game to override between ticks.
fovConnection = RunService.RenderStepped:Connect(function()
    pcall(function()
        local camera = workspace.CurrentCamera
        if camera and camera.FieldOfView ~= desiredFOV then
            camera.FieldOfView = desiredFOV
        end
    end)
end)

VisualCategory:Slider("FOV", 70, 120, 70, function(value)
    desiredFOV = value
end)

-- ESP Variables (Universal)
local espEnabled = {
    Door = false,
    Objective = false,
    Entity = false
}
local espHighlights = {}
local espUpdateLoop

-- Function to clear ESP highlights
local function clearESP(espType)
    if espHighlights[espType] then
        for _, highlight in pairs(espHighlights[espType]) do
            if highlight and highlight.Parent then
                highlight:Destroy()
            end
        end
        espHighlights[espType] = {}
    end
end

-- Function to create ESP for doors
local function createDoorESP()
    -- Don't clear, just add new ones that don't have ESP yet
    if not espHighlights.Door then
        espHighlights.Door = {}
    end
    
    for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
        pcall(function()
            local door = room:FindFirstChild("Door")
            if door and door:IsA("Model") then
                -- Check if this door already has ESP
                local hasESP = false
                for _, v in pairs(espHighlights.Door) do
                    if v and v.Parent == door then
                        hasESP = true
                        break
                    end
                end
                
                if not hasESP then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(0, 255, 0)
                    highlight.OutlineColor = Color3.fromRGB(0, 200, 0)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                    highlight.Parent = door
                    table.insert(espHighlights.Door, highlight)
                end
            end
        end)
    end
end

-- Function to create ESP for objectives
local function createObjectiveESP()
    clearESP("Objective")
    espHighlights.Objective = {}
    
    for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
        pcall(function()
            -- Check for KeyObtain
            local keyObtain = room:FindFirstChild("KeyObtain", true)
            if keyObtain then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineColor = Color3.fromRGB(200, 200, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = keyObtain
                table.insert(espHighlights.Objective, highlight)
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "ObjectiveESP"
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 2, 0)
                billboard.Parent = keyObtain
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = "Key"
                textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                textLabel.TextStrokeTransparency = 0
                textLabel.TextScaled = true
                textLabel.Font = Enum.Font.GothamBold
                textLabel.Parent = billboard
                
                table.insert(espHighlights.Objective, billboard)
            end
            
            -- Check for FuseHolder (Mines)
            local fuseHolder = room:FindFirstChild("FuseHolder", true)
            if fuseHolder then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(255, 255, 0)
                highlight.OutlineColor = Color3.fromRGB(200, 200, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = fuseHolder
                table.insert(espHighlights.Objective, highlight)
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "ObjectiveESP"
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 2, 0)
                billboard.Parent = fuseHolder
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = "Fuse"
                textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                textLabel.TextStrokeTransparency = 0
                textLabel.TextScaled = true
                textLabel.Font = Enum.Font.GothamBold
                textLabel.Parent = billboard
                
                table.insert(espHighlights.Objective, billboard)
            end
            
            -- Check for LiveHintBook in Bookshelves
            local assets = room:FindFirstChild("Assets")
            if assets then
                for _, bookshelf in pairs(assets:GetChildren()) do
                    if bookshelf.Name:match("Bookshelves") then
                        local liveHintBook = bookshelf:FindFirstChild("LiveHintBook", true)
                        if liveHintBook then
                            local highlight = Instance.new("Highlight")
                            highlight.FillColor = Color3.fromRGB(255, 255, 0)
                            highlight.OutlineColor = Color3.fromRGB(200, 200, 0)
                            highlight.FillTransparency = 0.5
                            highlight.OutlineTransparency = 0
                            highlight.Parent = liveHintBook
                            table.insert(espHighlights.Objective, highlight)
                            
                            local billboard = Instance.new("BillboardGui")
                            billboard.Name = "ObjectiveESP"
                            billboard.AlwaysOnTop = true
                            billboard.Size = UDim2.new(0, 100, 0, 50)
                            billboard.StudsOffset = Vector3.new(0, 2, 0)
                            billboard.Parent = liveHintBook
                            
                            local textLabel = Instance.new("TextLabel")
                            textLabel.Size = UDim2.new(1, 0, 1, 0)
                            textLabel.BackgroundTransparency = 1
                            textLabel.Text = "Book"
                            textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                            textLabel.TextStrokeTransparency = 0
                            textLabel.TextScaled = true
                            textLabel.Font = Enum.Font.GothamBold
                            textLabel.Parent = billboard
                            
                            table.insert(espHighlights.Objective, billboard)
                        end
                    end
                end
                
                -- Check for LeverForGate
                local lever = assets:FindFirstChild("LeverForGate")
                if lever then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 255, 0)
                    highlight.OutlineColor = Color3.fromRGB(200, 200, 0)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                    highlight.Parent = lever
                    table.insert(espHighlights.Objective, highlight)
                    
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "ObjectiveESP"
                    billboard.AlwaysOnTop = true
                    billboard.Size = UDim2.new(0, 100, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 2, 0)
                    billboard.Parent = lever
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.Text = "Lever"
                    textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    textLabel.TextStrokeTransparency = 0
                    textLabel.TextScaled = true
                    textLabel.Font = Enum.Font.GothamBold
                    textLabel.Parent = billboard
                    
                    table.insert(espHighlights.Objective, billboard)
                end
                
                -- Check for LiveBreakerPolePickup
                local breakerPole = assets:FindFirstChild("LiveBreakerPolePickup", true)
                if breakerPole then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 255, 0)
                    highlight.OutlineColor = Color3.fromRGB(200, 200, 0)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                    highlight.Parent = breakerPole
                    table.insert(espHighlights.Objective, highlight)
                    
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "ObjectiveESP"
                    billboard.AlwaysOnTop = true
                    billboard.Size = UDim2.new(0, 100, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 2, 0)
                    billboard.Parent = breakerPole
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.Text = "Breaker"
                    textLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    textLabel.TextStrokeTransparency = 0
                    textLabel.TextScaled = true
                    textLabel.Font = Enum.Font.GothamBold
                    textLabel.Parent = billboard
                    
                    table.insert(espHighlights.Objective, billboard)
                end
            end
        end)
    end
end

-- Function to create ESP for entities
local function createEntityESP()
    clearESP("Entity")
    espHighlights.Entity = {}
    
    -- ESP for Rush
    pcall(function()
        local rushMoving = workspace:FindFirstChild("RushMoving")
        if rushMoving and rushMoving:IsA("Model") then
            -- Check if already has ESP
            local hasESP = false
            for _, v in pairs(espHighlights.Entity) do
                if v.Parent == rushMoving then
                    hasESP = true
                    break
                end
            end
            
            if not hasESP then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
                highlight.OutlineColor = Color3.fromRGB(200, 0, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = rushMoving
                table.insert(espHighlights.Entity, highlight)
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "EntityESP"
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 3, 0)
                billboard.Parent = rushMoving
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = "RUSH"
                textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                textLabel.TextStrokeTransparency = 0
                textLabel.TextScaled = true
                textLabel.Font = Enum.Font.GothamBold
                textLabel.Parent = billboard
                
                table.insert(espHighlights.Entity, billboard)
            end
        end
    end)
    
    -- ESP for Ambush
    pcall(function()
        local ambushMoving = workspace:FindFirstChild("AmbushMoving")
        if ambushMoving and ambushMoving:IsA("Model") then
            -- Check if already has ESP
            local hasESP = false
            for _, v in pairs(espHighlights.Entity) do
                if v.Parent == ambushMoving then
                    hasESP = true
                    break
                end
            end
            
            if not hasESP then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(255, 100, 0)
                highlight.OutlineColor = Color3.fromRGB(200, 80, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = ambushMoving
                table.insert(espHighlights.Entity, highlight)
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "EntityESP"
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 3, 0)
                billboard.Parent = ambushMoving
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = "AMBUSH"
                textLabel.TextColor3 = Color3.fromRGB(255, 100, 0)
                textLabel.TextStrokeTransparency = 0
                textLabel.TextScaled = true
                textLabel.Font = Enum.Font.GothamBold
                textLabel.Parent = billboard
                
                table.insert(espHighlights.Entity, billboard)
            end
        end
    end)
    
    -- ESP for Eyes
    pcall(function()
        local eyes = workspace:FindFirstChild("Eyes")
        if eyes and eyes:IsA("Model") then
            -- Check if already has ESP
            local hasESP = false
            for _, v in pairs(espHighlights.Entity) do
                if v.Parent == eyes then
                    hasESP = true
                    break
                end
            end
            
            if not hasESP then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(150, 0, 255)
                highlight.OutlineColor = Color3.fromRGB(120, 0, 200)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = eyes
                table.insert(espHighlights.Entity, highlight)
                
                local billboard = Instance.new("BillboardGui")
                billboard.Name = "EntityESP"
                billboard.AlwaysOnTop = true
                billboard.Size = UDim2.new(0, 100, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 3, 0)
                billboard.Parent = eyes
                
                local textLabel = Instance.new("TextLabel")
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.Text = "EYES"
                textLabel.TextColor3 = Color3.fromRGB(150, 0, 255)
                textLabel.TextStrokeTransparency = 0
                textLabel.TextScaled = true
                textLabel.Font = Enum.Font.GothamBold
                textLabel.Parent = billboard
                
                table.insert(espHighlights.Entity, billboard)
            end
        end
    end)
    
    -- ESP for Figure
    for _, room in pairs(workspace.CurrentRooms:GetChildren()) do
        pcall(function()
            local figureSetup = room:FindFirstChild("FigureSetup")
            if figureSetup then
                local figureRig = figureSetup:FindFirstChild("FigureRig")
                if figureRig then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.fromRGB(200, 0, 0)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                    highlight.Parent = figureRig
                    table.insert(espHighlights.Entity, highlight)
                    
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "EntityESP"
                    billboard.AlwaysOnTop = true
                    billboard.Size = UDim2.new(0, 100, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 3, 0)
                    billboard.Parent = figureRig
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.Text = "FIGURE"
                    textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                    textLabel.TextStrokeTransparency = 0
                    textLabel.TextScaled = true
                    textLabel.Font = Enum.Font.GothamBold
                    textLabel.Parent = billboard
                    
                    table.insert(espHighlights.Entity, billboard)
                end
            end
        end)
    end
end

-- ESP Update Loop (continuously refreshes ESP)
local function startESPUpdateLoop()
    if espUpdateLoop then
        task.cancel(espUpdateLoop)
    end
    
    espUpdateLoop = task.spawn(function()
        while espEnabled.Door or espEnabled.Objective or espEnabled.Entity do
            task.wait(1) -- Update every second
            
            if espEnabled.Door then
                createDoorESP()
            end
            
            if espEnabled.Objective then
                createObjectiveESP()
            end
            
            if espEnabled.Entity then
                createEntityESP()
            end
        end
    end)
end

-- ESP Dropdown (Universal)
VisualCategory:Dropdown("ESP", {"Door", "Objective", "Entity"}, function(selected)
    if selected["Door"] and not espEnabled.Door then
        espEnabled.Door = true
        createDoorESP()
        startESPUpdateLoop()
    elseif not selected["Door"] and espEnabled.Door then
        espEnabled.Door = false
        clearESP("Door")
    end
    
    if selected["Objective"] and not espEnabled.Objective then
        espEnabled.Objective = true
        createObjectiveESP()
        startESPUpdateLoop()
    elseif not selected["Objective"] and espEnabled.Objective then
        espEnabled.Objective = false
        clearESP("Objective")
    end
    
    if selected["Entity"] and not espEnabled.Entity then
        espEnabled.Entity = true
        createEntityESP()
        startESPUpdateLoop()
    elseif not selected["Entity"] and espEnabled.Entity then
        espEnabled.Entity = false
        clearESP("Entity")
    end
    
    -- Stop update loop if all ESP disabled
    if not espEnabled.Door and not espEnabled.Objective and not espEnabled.Entity then
        if espUpdateLoop then
            task.cancel(espUpdateLoop)
            espUpdateLoop = nil
        end
    end
end)
table.insert(uiElements.Universal, espDropdown)

-- Entity Notifier Variables (Hotel only)
local entityNotifierEnabled = false
local notifiedEntities = {}

VisualCategory:Toggle("Entity Notifier", false, function(enabled)
    entityNotifierEnabled = enabled
    if not enabled then
        notifiedEntities = {}
    end
end)

-- Entity Notifier Loop
task.spawn(function()
    while true do
        task.wait(0.5)
        if entityNotifierEnabled then
            pcall(function()
                -- Check for RushMoving
                local rushMoving = workspace:FindFirstChild("RushMoving")
                if rushMoving and not notifiedEntities["RushMoving"] then
                    notifiedEntities["RushMoving"] = true
                    Window:Notify({
                        Text = "Rush is coming!",
                        Duration = 5,
                        Type = "Error"
                    })
                elseif not rushMoving and notifiedEntities["RushMoving"] then
                    notifiedEntities["RushMoving"] = nil
                end
                
                -- Check for AmbushMoving
                local ambushMoving = workspace:FindFirstChild("AmbushMoving")
                if ambushMoving and not notifiedEntities["AmbushMoving"] then
                    notifiedEntities["AmbushMoving"] = true
                    Window:Notify({
                        Text = "Ambush is coming!",
                        Duration = 5,
                        Type = "Error"
                    })
                elseif not ambushMoving and notifiedEntities["AmbushMoving"] then
                    notifiedEntities["AmbushMoving"] = nil
                end
                
                -- Check for Eyes
                local eyes = workspace:FindFirstChild("Eyes")
                if eyes and not notifiedEntities["Eyes"] then
                    notifiedEntities["Eyes"] = true
                    Window:Notify({
                        Text = "Eyes has appeared!",
                        Duration = 5,
                        Type = "Error"
                    })
                elseif not eyes and notifiedEntities["Eyes"] then
                    notifiedEntities["Eyes"] = nil
                end
            end)
        end
    end
end)

-- CREATE SETTINGS CATEGORY
local SettingsCategory = Window:CreateCategory("Settings", "âš™ï¸")

-- Function to destroy the entire script
local function destroyScript()
    -- Disconnect all connections
    if lightingConnection then
        lightingConnection:Disconnect()
    end
    if fovConnection then
        fovConnection:Disconnect()
    end
    
    -- Cancel all running loops
    if spoofCrouchLoop then
        task.cancel(spoofCrouchLoop)
    end
    if antiSpeedLoop then
        task.cancel(antiSpeedLoop)
    end
    if bypassLoop then
        task.cancel(bypassLoop)
    end
    if speedLoop then
        task.cancel(speedLoop)
    end
    if noAccelLoop then
        task.cancel(noAccelLoop)
    end
    if autoProxiLoop then
        task.cancel(autoProxiLoop)
    end
    if flyLoop then
        task.cancel(flyLoop)
    end
    if espUpdateLoop then
        task.cancel(espUpdateLoop)
    end
    
    -- Clear all ESP
    clearESP("Door")
    clearESP("Objective")
    clearESP("Entity")
    
    -- Restore all modified properties
    pcall(function()
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer
        local Character = LocalPlayer and LocalPlayer.Character
        
        if Character then
            local Humanoid = Character:FindFirstChild("Humanoid")
            if Humanoid then
                Humanoid.WalkSpeed = originalWalkSpeed
            end
            
            local hrp = Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.CustomPhysicalProperties = originalHrpProps
            end
            
            if clonedCollision then
                clonedCollision:Destroy()
            end
            
            for _, part in pairs(Character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end)
    
    -- Restore lighting
    if fullbrightEnabled then
        local Lighting = game:GetService("Lighting")
        for property, value in pairs(originalLighting) do
            Lighting[property] = value
        end
    end
    
    -- Restore Screech
    if screechDisabled and screechOriginalParent then
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local screech = ReplicatedStorage.Entities:FindFirstChild("Screech")
            if screech then
                screech.Parent = screechOriginalParent
            end
        end)
    end
    
    -- Notify user
    Window:Notify({
        Text = "Script destroyed! All features disabled.",
        Duration = 3,
        Type = "Warning"
    })
    
    -- Destroy the UI window
    task.wait(0.5)
    Window:Destroy()
end

-- Destroy Script Button
SettingsCategory:Button("Destroy Script", function()
    Window:Notify({
        Text = "Are you sure? Press again to confirm.",
        Duration = 3,
        Type = "Warning"
    })
    
    -- Wait for second confirmation
    task.wait(3)
    
    -- Create a confirmation prompt
    local confirmationWindow = Library:CreateWindow({
        Title = "Confirm Destruction",
        Size = Vector2.new(400, 150),
        Keybind = Enum.KeyCode.RightShift
    })
    
    local confirmCategory = confirmationWindow:CreateCategory("Confirmation", "âš ï¸")
    confirmCategory:Label("Are you sure you want to destroy the script?")
    confirmCategory:Button("YES - Destroy", function()
        destroyScript()
    end)
    confirmCategory:Button("NO - Cancel", function()
        confirmationWindow:Destroy()
    end)
end)

-- Clear All Settings Button
SettingsCategory:Button("Reset All Settings", function()
    -- Disable all toggles
    spoofCrouchEnabled = false
    screechDisabled = false
    antiSpeedEnabled = false
    bypassEnabled = false
    speedEnabled = false
    noAccelEnabled = false
    autoProxiEnabled = false
    flyEnabled = false
    noclipEnabled = false
    fullbrightEnabled = false
    entityNotifierEnabled = false
    
    -- Reset values
    speedValue = 16
    proximityReach = 0
    desiredFOV = 70
    
    Window:Notify({
        Text = "All settings have been reset!",
        Duration = 2,
        Type = "Success"
    })
end)

-- Hide UI Button
SettingsCategory:Button("Hide UI", function()
    Window:SetVisible(false)
end)

-- Show Info Button
SettingsCategory:Button("Show Info", function()
    Window:Notify({
        Text = "ZeScript Doors v1.0 - Press RightShift to toggle UI",
        Duration = 5,
        Type = "Info"
    })
end)
